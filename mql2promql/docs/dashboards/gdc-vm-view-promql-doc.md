# MQL to PromQL Conversion Guide - GDC VM View 

This document explains the proposed translations to Prometheus Query Language (PromQL) of the `gdc-vm-view.json` dashboard and the Testing Results

## `dashboards/gdc-vm-view.json`

| Group | Input Query Title | Input Query Type | Source Query | LLM Reasoning | LLM Output Query Type | LLM Output PromQL Query | Comments |
| --- | --- | --- | --- | --- | --- | --- | --- |
| N/A | VM States | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_phase_count | group_by 1m, [value_kubevirt_vmi_phase_count_mean: mean(value.kubevirt_vmi_phase_count)] | every 1m | group_by [metric.phase], [value_kubevirt_vmi_phase_count_mean_aggregate: aggregate(value_kubevirt_vmi_phase_count_mean)]` | The MQL query aggregates the `kubevirt_vmi_phase_count` metric by phase. The PromQL equivalent uses `count by (state) (kubevirt_info)` which provides a similar breakdown of VM states. | PromQL | `count by (state) (kubevirt_info)` | |
| N/A | CPU usage per VM | MQL | `fetch k8s_container :: kubernetes.io/anthos/container/cpu/core_usage_time | align rate(2m) | every 2m | group_by [resource.pod_name], [value_core_usage_time_rate: mean(value.core_usage_time)]` | The MQL query calculates the rate of CPU usage per pod. The PromQL equivalent uses `rate(kubevirt_vmi_vcpu_seconds[2m])` to get the rate of vCPU usage per VM. | PromQL | `rate(kubevirt_vmi_vcpu_seconds[2m])` | |
| N/A | Network TX Bytes/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_transmit_bytes_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_transmit_bytes_total_rate: mean(value.network_transmit_bytes_total)]` | The MQL query calculates the rate of transmitted bytes. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_transmit_bytes_total[2m])` | |
| N/A | Network RX Bytes/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_receive_bytes_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_receive_bytes_total_rate: mean(value.network_receive_bytes_total)]` | The MQL query calculates the rate of received bytes. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_receive_bytes_total[2m])` | |
| N/A | Network TX Errors/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_transmit_errors_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_transmit_errors_total_rate: mean(value.network_transmit_errors_total)]` | The MQL query calculates the rate of transmit errors. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_transmit_errors_total[2m])` | |
| N/A | Network RX Errors/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_receive_errors_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_receive_errors_total_rate: mean(value.network_receive_errors_total)]` | The MQL query calculates the rate of receive errors. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_receive_errors_total[2m])` | |
| N/A | Network TX Packets/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_transmit_packets_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_transmit_packets_total_rate: mean(value.network_transmit_packets_total)]` | The MQL query calculates the rate of transmitted packets. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_transmit_packets_total[2m])` | |
| N/A | Network RX Packets/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_receive_packets_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_receive_packets_total_rate: mean(value.network_receive_packets_total)]` | The MQL query calculates the rate of received packets. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_receive_packets_total[2m])` | |
| N/A | Network TX Packets dropped/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_transmit_packets_dropped_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_transmit_packets_dropped_total_rate: mean(value.network_transmit_packets_dropped_total)]` | The MQL query calculates the rate of dropped transmit packets. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_transmit_packets_dropped_total[2m])` | |
| N/A | Network RX Packets dropped/s per VM per interface | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_network_receive_packets_dropped_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.interface], [value_network_receive_packets_dropped_total_rate: mean(value.network_receive_packets_dropped_total)]` | The MQL query calculates the rate of dropped receive packets. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_network_receive_packets_dropped_total[2m])` | |
| N/A | Storage write iops per VM per disk | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_storage_iops_write_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.drive], [value_storage_iops_write_total_rate: mean(value.storage_iops_write_total)]` | The MQL query calculates the rate of storage write IOPS. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_storage_iops_write_total[2m])` | |
| N/A | Storage read iops per VM per disk | MQL | `fetch k8s_container :: kubernetes.io/anthos/kubevirt_vmi_storage_iops_read_total | align rate(2m) | every 2m | group_by [resource.pod_name, metric.drive], [value_storage_iops_read_total_rate: mean(value.storage_iops_read_total)]` | The MQL query calculates the rate of storage read IOPS. This is a direct translation to `rate()` in PromQL. | PromQL | `rate(kubevirt_vmi_storage_iops_read_total[2m])` | |
| N/A | VMs | MQL | `metric.type="prometheus.googleapis.com/kubevirt_info/gauge" resource.type="prometheus_target"` | The MQL `timeSeriesFilter` is converted to a PromQL query. The metric name is converted, and the filters are applied as label matchers. | PromQL | `kubevirt_info` | |
